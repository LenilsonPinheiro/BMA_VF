

<div id="cookie-consent-banner">
    <div class="cc-card">
        
        <div class="cc-header">
            <div class="cc-icon"><i class="bi bi-shield-lock-fill"></i></div>
            <div class="cc-content">
                <h4>Sua Privacidade</h4>
                <p>
                    Utilizamos cookies para personalizar sua experiência. 
                    Veja nossa <a href="{{ url_for('main.politica_privacidade') }}" class="cc-link">Política de Privacidade</a>.
                </p>
            </div>
        </div>

        <div id="cc-pref-panel" class="cc-preferences">
            <div class="cc-switch-row">
                <div>
                    <span class="cc-switch-label">Essenciais</span>
                    <span class="cc-switch-desc">Funcionamento básico e segurança.</span>
                </div>
                <label class="cc-switch">
                    <input type="checkbox" checked disabled>
                    <span class="cc-slider"></span>
                </label>
            </div>
            <div class="cc-switch-row">
                <div>
                    <span class="cc-switch-label">Analíticos</span>
                    <span class="cc-switch-desc">Ajuda a melhorar o site.</span>
                </div>
                <label class="cc-switch">
                    <input type="checkbox" id="cc-analytics" checked>
                    <span class="cc-slider"></span>
                </label>
            </div>
            <button class="cc-btn cc-btn-accept w-100 mt-2" onclick="CookieConsent.savePreferences()">Salvar Preferências</button>
        </div>

        <div id="cc-main-actions" class="cc-actions">
            <button class="cc-btn cc-btn-ghost" onclick="CookieConsent.rejectAll()">Rejeitar</button>
            <button class="cc-btn cc-btn-accept" onclick="CookieConsent.acceptAll()">Aceitar</button>
        </div>
        
        <span id="cc-manage-btn" class="cc-manage-link" onclick="CookieConsent.togglePreferences()">Gerenciar Preferências</span>

    </div>
</div>

<script>
    const CookieConsent = {
        key: 'bm_privacy_consent',
        banner: document.getElementById('cookie-consent-banner'),
        prefPanel: document.getElementById('cc-pref-panel'),
        mainActions: document.getElementById('cc-main-actions'),
        manageBtn: document.getElementById('cc-manage-btn'),

        init() {
            // Verifica se já existe consentimento salvo
            const consent = localStorage.getItem(this.key);
            if (!consent) {
                // Delay para não assustar o usuário na entrada
                setTimeout(() => this.banner.classList.add('show'), 2000);
            } else {
                this.applyConsent(JSON.parse(consent));
            }
        },

        togglePreferences() {
            if (this.prefPanel.style.display === 'block') {
                this.prefPanel.style.display = 'none';
                this.mainActions.style.display = 'grid';
                this.manageBtn.style.display = 'block';
            } else {
                this.prefPanel.style.display = 'block';
                this.mainActions.style.display = 'none';
                this.manageBtn.style.display = 'none';
            }
        },

        acceptAll() {
            const preferences = {
                essential: true,
                analytics: true,
                marketing: true,
                timestamp: new Date().toISOString()
            };
            this.saveAndClose(preferences);
        },

        rejectAll() {
            const preferences = {
                essential: true,
                analytics: false,
                marketing: false,
                timestamp: new Date().toISOString()
            };
            this.saveAndClose(preferences);
        },

        savePreferences() {
            const analytics = document.getElementById('cc-analytics').checked;
            const preferences = {
                essential: true,
                analytics: analytics,
                marketing: false, // Simplificado
                timestamp: new Date().toISOString()
            };
            this.saveAndClose(preferences);
        },

        saveAndClose(preferences) {
            localStorage.setItem(this.key, JSON.stringify(preferences));
            this.banner.classList.remove('show');
            this.applyConsent(preferences);
        },

        applyConsent(preferences) {
            // Aqui é onde os scripts reais seriam ativados
            if (preferences.analytics) {
                console.log('Analytics Activated');
                // Ex: window.dataLayer.push({'event': 'consent_granted'});
            }
        }
    };

    document.addEventListener('DOMContentLoaded', () => CookieConsent.init());
</script>